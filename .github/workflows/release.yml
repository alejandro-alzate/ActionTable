name: Build Blender Addon

on:
    push:
        branches:
            - main
        tags:
            - "v*.*.*"

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Prepare addon
              run: |
                  mkdir build
                  cp -r src build/ActionTables
                  cd build
                  zip -r ../ActionTables.zip ActionTables

            - name: Upload artifact (always)
              uses: actions/upload-artifact@v4
              with:
                  name: ActionTables
                  path: ActionTables.zip

    release:
        runs-on: ubuntu-latest
        needs: build
        if: startsWith(github.ref, 'refs/tags/v')
        permissions:
            contents: write

        steps:
            - name: Download artifact
              uses: actions/download-artifact@v4
              with:
                  name: ActionTables
                  path: .

            - name: Create GitHub Release
              uses: softprops/action-gh-release@v2
              with:
                  files: ActionTables.zip
